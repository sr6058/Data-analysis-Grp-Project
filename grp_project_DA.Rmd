


knitr::opts_chunk$set(echo = TRUE)
setwd("C:/Users/hp/Desktop/DA grp project")
library(tidyverse)
library(stargazer)
library(gt)
library(dplyr)
educ <- read.csv("sect2_education.csv", na.strings = " ")
health<-read.csv("sect3_health.csv", na.strings = " ")
remittances<-read.csv("sect5_remittances.csv", na.strings = " ")
roster<-read.csv("sect1_roster.csv", na.strings = " ")
labour <- read.csv("sect4a1_labour.csv", na.strings = " ")




Merging datasets


neduc <- subset(educ, select=c("hhid", "zone","lga", "state", "sector", "indiv" ,"ea", "s02q08"))
nhealth <- subset(health, select=c("hhid", "zone","lga", "state", "sector", "indiv" ,"ea", "s03q24"))
nlabour <- subset(labour, select=c("hhid", "zone","lga", "state", "sector", "indiv" ,"ea", "s04aq05", "s04aq12"))
nremittances <- subset(remittances, select=c("hhid", "zone","lga", "state", "sector", "indiv" ,"ea", "s05q02b", "s05q02a") )
nroster <- subset(roster, select=c("hhid", "zone","lga", "state", "sector", "indiv" ,"ea", "s01q02"))

#Merging variables in one dataset
merged_data <- inner_join(neduc, nhealth,by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) %>% 
  inner_join(nlabour,by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) %>%  
  inner_join(nremittances, by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) %>% 
  inner_join(nroster, by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) 





#Ruqi's code
#Merge Dataset Per Joint Unique Identifiers

#please note this is not adjusted to a certain hh or indiv level.
nEducation<-subset(Education, select = c( 'hhid','zone','lga', 'state', 'sector', 'indiv' ,'ea','s02q08'))
nRemittances<-subset(Remittances, select = c('hhid', 'zone','lga', 'state', 'sector', 'indiv' ,'ea','s05q02a'))
nRoster<-subset(Roster, select = c('hhid','zone','lga', 'state', 'sector', 'indiv' ,'ea','s01q02'))
nHealth<-subset(Health, select = c( 'hhid','zone','lga', 'state', 'sector', 'indiv' ,'ea','s03q24'))

#Merging Existin Datasets using Merge()
merge_data <- merge(nEducation, nHealth, by=c( 'hhid','zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea'), all=TRUE)

merge_data <- merge(merge_data, nRemittances, by=c('hhid','zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea'), all=TRUE)

merge_data <- merge(merge_data, nRoster, by=c( 'hhid','zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea'), all=TRUE)
#Rename the Columns on the Merged Data Set
merge_data <- merge_data %>% 
    rename(education=s02q08, health=s03q24, remittances=s05q02a,roster=s01q02)

#Cleaning missing Values from the data set
 merge_data_drop <- merge_data %>% drop_na(education, health, remittances, roster)
 



#Ella's code (temporary)

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("/Users/ella/Downloads/Data Analysis Final Project/NGA_2018_LSS_v01_M_CSV/Household")

library(tidyverse)
library(stargazer)
library(gt)
library(dplyr)

educ <- read.csv("sect2_education.csv", na.strings = " ")
health<-read.csv("sect3_health.csv", na.strings = " ")
labour <- read.csv("sect4a1_labour.csv", na.strings = " ")
remittances<-read.csv("sect5_remittances.csv", na.strings = " ")
roster<-read.csv("sect1_roster.csv", na.strings = " ")

#s02q08: "What is [NAME]'s highest qualification attained?"
#s02q13: "What is the main reason why [NAME] is not currently attending school?"
neduc <- subset(educ, select=c("hhid", "zone","lga", "state", "sector", "indiv","ea", "s02q08", "s02q13"))
#s03q24: "Does [NAME] have difficulty walking or climbing steps?"
nhealth <- subset(health, select=c("hhid", "zone","lga", "state", "sector", "indiv","ea", "s03q24"))
#s04aq05: "During the past 7 days, how many hours has [NAME] done wage/salaried work?"
nlabour <- subset(labour, select=c("hhid", "zone","lga", "state", "sector", "indiv", "ea", "s04aq05"))
#s05q02a: "What was the amount of cash [NAME] received?"
#s05q02a: "Currency"
nremittances <- subset(remittances, select=c("hhid", "zone","lga", "state", "sector", "indiv" ,"ea", "s05q02a", "s05q02b") )
#s01q02: "What is the gender of [NAME]?"
#s01q06b: "Year of birth"
#s01q07: "What is [NAME]'s present marital status?"
nroster <- subset(roster, select=c("hhid", "zone","lga", "state", "sector", "indiv", "ea", "s01q02", "s01q06b", "s01q07"))

```


```{r}
#Merging Data
merged_data <- inner_join(neduc, nhealth,by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) %>% 
  inner_join(nlabour,by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) %>%  
  inner_join(nroster, by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') ) %>%
  inner_join(nremittances, by=c('hhid', 'zone',
                            'lga', 'state', 'sector', 'indiv' ,'ea') )
```


```{r}
#Renaming variables for user friendliness
merged_data <- merged_data %>% 
    rename(education = s02q08, why = s02q13, health = s03q24, labor = s04aq05, remittances = s05q02a, currency = s05q02b, gender = s01q02, yearbirth = s01q06b, marriage = s01q07)
```

```{r}
#Checking data
print("Education:")
typeof(merged_data$education)
table(merged_data$education)
print("Why:")
typeof(merged_data$why)
table(merged_data$why)
print("Health:")
typeof(merged_data$health)
table(merged_data$health) #Note: Need to fix health because it is a list
print("Labor:")
typeof(merged_data$labor)
table(merged_data$labor)
print("Gender:")
typeof(merged_data$gender)
table(merged_data$gender)
print("Birth Year:")
typeof(merged_data$yearbirth)
table(merged_data$yearofbirth) #Note: Why is this table of extent 0?
```

```{r}
#Creating binary for gender (isfemale, 0 = No and 1 = Yes)
merged_data$isfemale <- ifelse(merged_data$gender == 2, 1, 0)
```

```{r}
#Creating the first binary education specification
merged_data$educated_spef1 <- ifelse(merged_data$education == 1, 0, 1)
table(merged_data$educated_spef1)

#Creating the second binary education specification
merged_data$educated_spef2 <- ifelse(merged_data$education <= 6, 0, 1)
table(merged_data$educated_spef2)
```

```{r}
#Dropping those who are done with the school system
merged_data_dr <- subset(merged_data, why != 1 & why != 15)
#Dropping NA observations
merged_data_drop <- merged_data_dr %>% drop_na(education, health, labor, gender, yearbirth, marriage)
```


```{r}
#Running regressions
summary(lm(educated_spef1 ~ health + labor + yearbirth + isfemale*marriage, data = merged_data))
summary(lm(educated_spef2 ~ health + labor + yearbirth + isfemale*marriage, data = merged_data))
```
# Ruqi's proposed alternative to the regression code
Please note that the regressions have been assigned names in the off chance that there is a wait to plot MLRs.
```{r}

#Main regression with interaction term
mint<-lm(educated_spef1 ~ health + labor + yearbirth + isfemale+ marriage+ isfemale*marriage, data = merged_data_drop)
summary(mint)
#Main regression without interaction term
mwithoutint<-lm(educated_spef1 ~ health + labor + yearbirth + isfemale+ marriage+ isfemale*marriage, data = merged_data_drop)
summary(mwithoutint)
```

```{r}
#Alternative reaction with interaction term
aint<-lm(educated_spef2 ~ health + labor + yearbirth + isfemale+ marriage+ isfemale*marriage, data = merged_data_drop)
summary(aint)
#Alternative Specification without interaction term
awithoutint<-lm(educated_spef2 ~ health + labor + yearbirth + isfemale+marriage, data = merged_data_drop)
summary(awithoutint)
```
# Ruqi's data visualization
```{r}
#Plotting the variables
#Education is a categorical variable. It is most apt to use a bar graph to plot education.

#Our first specification uses a cutoff between those who received no education at all vs. those who received some education.
#0=No education and 1= Any education
ggplot(merged_data_drop, aes(x=educated_spef1)) +
  geom_bar(position = "dodge", width = 0.25, color= "blue", fill= "blue") + 
  labs(x = "Level of Education", y = "Frequency") 
#Please note we need to edit the y axis to show exactly the breakdown of the data.

#Our breakdown of data for the alternative specification.
#0= obtained at most a senior school certificate.
#1=obtained education beyond a senior school certificate
```


```{r}
##Our breakdown of data for the alternative specification.
#0= obtained at most a senior school certificate.
#1=obtained education beyond a senior school certificate
ggplot(merged_data_drop, aes(x=educated_spef2)) +
  geom_bar(position = "dodge", width = 0.25, color= "pink", fill= "pink") + 
  labs(x = "Level of Education", y = "Frequency")
```


```{r}
#Our data for labor is continuous. This variable we used looks at the amount of salaried hours those who took the survery worked in the last 7 days. To visualize this data, a boxplot is more appropriate. This will also provide us with some idea as to how the data is distributed and where outliers are.
ggplot(merged_data_drop, aes(labor)) +
  geom_boxplot(color = "black", outlier.colour = "blue")+
  labs(title = "Number of Salaried Hours Worked in the Last 7 Days",
      x = "Hours",
      y = "Frequency")
# There are numerous outliers on either side of the data
#how to edit this code to show the median?

```
